import{r as n,j as e}from"./index-V-x1CcZ_.js";import{c as C,u as he,g as fe,U as pe}from"./useToast-C0bm4l8s.js";import{B as ge}from"./BottomNav-BtuPnx2H.js";import{C as V,a as xe,b as be}from"./circle-x-W5mkuklc.js";import{M as ve,X as ye,D as je,A as we}from"./x-DPaissle.js";/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],G=C("camera",Ne);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],Ce=C("log-out",ke);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],Ie=C("log-in",Se);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],Fe=C("wifi",Pe);function _e(){const{addToast:E}=he(),[l,S]=n.useState({name:"",id:""}),[z,X]=n.useState(new Date),[y,p]=n.useState({lat:null,lng:null,address:""}),[m,I]=n.useState({ssid:"Checking...",available:!1,ip:null,localIP:null,verified:!1,connectionType:"unknown"}),[Te,M]=n.useState([]),[g,c]=n.useState({type:"",message:""}),[j,L]=n.useState(!1),[De,We]=n.useState(!1),[P,q]=n.useState(!1),[w,J]=n.useState(null),[N,R]=n.useState([]),[h,K]=n.useState({}),[_,Q]=n.useState(!1),[Y,k]=n.useState(!1),[x,b]=n.useState(null),[$,O]=n.useState(null),[F,T]=n.useState(null),f=n.useRef(null),D=n.useRef(null);n.useEffect(()=>{te()},[]),n.useEffect(()=>{const t=setInterval(()=>X(new Date),1e3);return()=>clearInterval(t)},[]),n.useEffect(()=>{W()},[]),n.useEffect(()=>{try{const t=localStorage.getItem("employeeSessionId"),a=localStorage.getItem("employeeSessionName");t&&S({id:t.toUpperCase(),name:a||""})}catch{}Q(!0)},[]),n.useEffect(()=>{if(!_||!l.id)return;const t=h[l.id];t&&t.fullName&&t.fullName!==l.name&&S(a=>({...a,name:t.fullName}))},[h,l.id,_]),n.useEffect(()=>{if(!navigator.geolocation){p({lat:null,lng:null,address:"Browser does not support Geolocation"});return}navigator.geolocation.getCurrentPosition(t=>{const{latitude:a,longitude:r}=t.coords;p({lat:a,lng:r,address:"Loading address..."}),fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${a}&lon=${r}`).then(s=>s.json()).then(s=>p(i=>({...i,address:s.display_name||"Unknown"}))).catch(()=>p(s=>({...s,address:"Could not retrieve address"})))},()=>{p({lat:null,lng:null,address:"Could not retrieve location"})},{maximumAge:60*1e3,timeout:5e3})},[]);const W=async()=>{try{I(o=>({...o,ssid:"Checking IP...",verified:!1}));let t="unknown";if("connection"in navigator){const o=navigator.connection||navigator.mozConnection||navigator.webkitConnection;t=o&&(o.effectiveType||o.type)||"unknown"}let a=null,r=null;const s=["https://api.ipify.org?format=json","https://api.bigdatacloud.net/data/client-ip","https://ipapi.co/json/","https://api.my-ip.io/ip.json"];for(const o of s)try{const d=await(await fetch(o)).json();if(a=d.ip||d.ipString||d.IPv4||null,a)break}catch{}try{r=await Z()}catch{r=null}const i=ee(a,r);I({ssid:i?i.name:"Unknown WiFi",available:!!i,verified:!!i,ip:a||"Not available",localIP:r,connectionType:t}),a||(c({type:"error",message:"âš ï¸ Could not retrieve public IP. Please check your network connection."}),setTimeout(()=>c({type:"",message:""}),3e3))}catch(t){console.error("Error detecting wifi:",t),I({ssid:"Could not determine WiFi",available:!1,verified:!1,ip:"Connection error",localIP:null,connectionType:"unknown"})}};n.useEffect(()=>{N.length&&W()},[N]);const Z=()=>new Promise((t,a)=>{const r=new RTCPeerConnection({iceServers:[]});try{r.createDataChannel(""),r.createOffer().then(s=>r.setLocalDescription(s)).catch(s=>console.warn(s)),r.onicecandidate=s=>{if(!s||!s.candidate||!s.candidate.candidate)return;const o=/([0-9]{1,3}(\.[0-9]{1,3}){3})/.exec(s.candidate.candidate);o&&(t(o[1]),r.close())},setTimeout(()=>{try{r.close()}catch{}a("Timeout")},2500)}catch(s){a(s)}}),ee=(t,a)=>{if(!t&&!a||!N.length)return null;const r=s=>s?.split(".").slice(0,3).join(".")+".";for(const s of N){const i=!!s.publicIP,o=!!s.localIP;if(i){if(t===s.publicIP)return s;continue}if(o&&a&&a.startsWith(r(s.localIP)))return s}return null},te=async()=>{try{c({type:"info",message:"Connecting to Firebase..."});const t=await fe(),{database:a,ref:r,onValue:s}=t;J(t),q(!0),c({type:"success",message:"âœ… Firebase connected successfully!"}),se(a,r,s),ae(a,r,s),re(a,r,s),setTimeout(()=>c({type:"",message:""}),2500)}catch(t){console.error("Firebase error:",t),c({type:"error",message:"âŒ Firebase connection error: "+(t?.message||t)})}},se=(t,a,r)=>{try{const s=a(t,"checkins");r(s,i=>{const o=i.val();if(o){const u=Object.keys(o).map(d=>({firebaseId:d,...o[d]}));u.sort((d,v)=>new Date(v.timestamp)-new Date(d.timestamp)),M(u)}else M([])})}catch(s){console.error("Load checkins error",s)}},ae=(t,a,r)=>{try{const s=a(t,"companyWifis");r(s,i=>{const o=i.val();if(o){const u=Object.keys(o).map(d=>({id:d,...o[d]}));R(u)}else R([])})}catch(s){console.error("Load company WiFis error",s)}},re=(t,a,r)=>{try{const s=a(t,"employees");r(s,i=>{const o=i.val()||{};K(o)})}catch(s){console.error("Load employees error",s)}},A=async t=>{if(!P){c({type:"error",message:"âš ï¸ Firebase not connected. Please wait..."});return}if(!l.name||!l.id){c({type:"error",message:"âš ï¸ Please enter full employee information!"});return}const a=h[l.id];if(!a){c({type:"error",message:"âš ï¸ Employee ID does not exist in the system."});return}if(a.active===!1){c({type:"error",message:"âš ï¸ Employee is Inactive, cannot check-in."});return}if(a.fullName&&a.fullName!==l.name&&S(r=>({...r,name:a.fullName})),!m.verified){c({type:"error",message:"âš ï¸ WiFi not verified. Please connect to company WiFi to check-in."});return}T(t),b(null),k(!0),H()},H=async()=>{try{const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:640},height:{ideal:480}}});O(t),f.current&&(f.current.srcObject=t)}catch(t){c({type:"error",message:"âŒ Cannot access camera: "+t.message}),k(!1)}},U=()=>{if($&&($.getTracks().forEach(t=>t.stop()),O(null)),f.current)try{f.current.srcObject=null}catch{}},oe=()=>{if(!f.current||!D.current)return;const t=D.current,a=f.current,r=800,s=600;let i=a.videoWidth||640,o=a.videoHeight||480;i>r&&(o=r/i*o,i=r),o>s&&(i=s/o*i,o=s),t.width=i,t.height=o,t.getContext("2d").drawImage(a,0,0,i,o);const d=t.toDataURL("image/jpeg",.6);b(d),U()},ie=()=>{b(null),H()},ne=()=>{U(),k(!1),b(null),T(null)},le=async()=>{if(!x){c({type:"error",message:"âš ï¸ Please take a photo!"});return}if(!w){c({type:"error",message:"âš ï¸ Firebase not ready!"});return}L(!0),c({type:"info",message:"â³ Saving..."});try{const t=new Date().toISOString(),a={employeeId:l.id,employeeName:l.name,type:F,timestamp:t,photoBase64:x,location:{lat:y.lat,lng:y.lng,address:y.address},wifi:{ssid:m.ssid,verified:m.verified,publicIP:m.ip,localIP:m.localIP,connectionType:m.connectionType}},{database:r,ref:s,push:i}=w,o=s(r,"checkins");console.log("ðŸ”¥ About to save checkin data:",a),console.log("ðŸ”¥ Database ref:",o);const u=await i(o,a),d=u.key||null;console.log("ðŸ”¥ Firebase push result:",u),console.log("ðŸ”¥ Generated key:",d),setTimeout(async()=>{try{const{get:v}=w,ue=s(r,`checkins/${d}`),B=await v(ue);B.exists()?console.log("âœ… Data verified in Firebase:",B.val()):console.error("âŒ Data NOT found in Firebase after save!")}catch(v){console.error("âŒ Error verifying save:",v)}},1e3),k(!1),b(null),T(null),F==="in"?E({type:"success",message:e.jsxs("div",{className:"flex items-center",children:[e.jsx(je,{className:"mr-2",size:20}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold",children:"Check-in Successful!"}),e.jsx("div",{children:"Wish you a productive and energetic working day, No sale, No Money"})]})]}),duration:5e3}):F==="out"&&E({type:"success",message:e.jsxs("div",{className:"flex items-center",children:[e.jsx(we,{className:"mr-2",size:20}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold",children:"Check-out Successful!"}),e.jsx("div",{children:"Congratulations on having a productive day at work, keep trying to receive lots of $$$$ at the end of the month"})]})]}),duration:5e3}),c({type:"success",message:"âœ… Operation completed successfully!"}),setTimeout(()=>c({type:"",message:""}),4e3),ce(x,l.id,Date.now(),d)}catch(t){console.error("Save error:",t),c({type:"error",message:"âŒ Error saving data: "+(t?.message||t)})}finally{L(!1)}},ce=async(t,a,r,s)=>{if(!(!w||!s))try{console.log("ðŸ“¸ Photo upload temporarily disabled - using base64 storage"),console.log("Record key:",s),console.log("Employee:",a),console.log("âœ… Photo data saved to Firebase with base64")}catch(i){console.error("Background upload error:",i)}},de=t=>t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),me=t=>t.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 pb-28",children:[e.jsx("div",{className:"relative backdrop-blur-xl bg-white/10 border-b border-white/20 px-6 py-8",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx("div",{className:"text-6xl font-bold mb-2 drop-shadow-lg tracking-tight",children:de(z)}),e.jsx("div",{className:"text-sm opacity-90 font-medium",children:me(z)})]})}),e.jsxs("div",{className:"px-6 py-6 space-y-6",children:[e.jsxs("div",{className:"relative backdrop-blur-xl bg-white/90 border border-white/40 rounded-3xl shadow-xl overflow-hidden p-5",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-50/50 to-purple-50/50 pointer-events-none"}),e.jsxs("div",{className:"relative flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white shadow-lg",children:e.jsx(pe,{size:28,strokeWidth:2.5})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-0.5 uppercase tracking-wide",children:"Employee"}),e.jsx("div",{className:"font-bold text-xl text-gray-800",children:l.name||"Not logged in"}),e.jsxs("div",{className:"text-sm text-gray-600 font-medium",children:["ID: ",l.id||"-"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:`relative backdrop-blur-xl border-2 rounded-3xl shadow-xl overflow-hidden p-5 ${m.verified?"bg-green-400/20 border-green-400/50":"bg-orange-400/20 border-orange-400/50"}`,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 to-transparent pointer-events-none"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-2xl flex items-center justify-center ${m.verified?"bg-green-500":"bg-orange-500"}`,children:e.jsx(Fe,{className:"text-white",size:24,strokeWidth:2.5})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 uppercase tracking-wide mb-0.5",children:"Network"}),e.jsx("div",{className:"font-bold text-lg text-gray-800",children:m.ssid})]})]}),e.jsx("button",{onClick:W,className:"w-10 h-10 rounded-xl bg-white/70 hover:bg-white flex items-center justify-center text-lg transition shadow-md",children:"ðŸ”„"})]}),m.verified?e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-green-500/20 rounded-xl",children:[e.jsx(V,{size:18,className:"text-green-700"}),e.jsx("span",{className:"text-sm text-green-700 font-semibold",children:"Verified Network"})]}):e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-orange-500/20 rounded-xl",children:[e.jsx(xe,{size:18,className:"text-orange-700"}),e.jsx("span",{className:"text-sm text-orange-700 font-semibold",children:"Connect to company WiFi"})]})]})]}),e.jsxs("div",{className:"relative backdrop-blur-xl bg-white/90 border border-white/40 rounded-3xl shadow-xl overflow-hidden p-5",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-red-50/30 to-pink-50/30 pointer-events-none"}),e.jsxs("div",{className:"relative flex items-start gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-red-500 flex items-center justify-center text-white shadow-lg flex-shrink-0",children:e.jsx(ve,{size:24,strokeWidth:2.5})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs text-gray-600 uppercase tracking-wide mb-1",children:"Location"}),e.jsx("div",{className:"text-sm text-gray-700 font-medium line-clamp-2",children:y.address||"Fetching location..."})]})]})]})]}),g.message&&e.jsx("div",{className:`relative backdrop-blur-xl border rounded-2xl shadow-lg overflow-hidden p-4 ${g.type==="success"?"bg-green-400/20 border-green-300/40":g.type==="info"?"bg-blue-400/20 border-blue-300/40":"bg-red-400/20 border-red-300/40"}`,children:e.jsxs("div",{className:"relative flex items-center gap-2",children:[g.type==="success"?e.jsx(V,{size:20}):e.jsx(be,{size:20}),e.jsx("div",{className:"whitespace-pre-line text-sm",children:g.message})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-8",children:[e.jsxs("button",{onClick:()=>A("in"),disabled:j||!P||!m.verified||!l.id||!h[l.id]||h[l.id]?.active===!1,className:"relative backdrop-blur-xl bg-gradient-to-br from-green-400 to-emerald-500 border-2 border-white/40 rounded-3xl shadow-2xl overflow-hidden py-8 disabled:opacity-50 disabled:cursor-not-allowed active:scale-95 transition-all",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/20 to-transparent pointer-events-none"}),e.jsxs("div",{className:"relative flex flex-col items-center gap-3 text-white",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-white/20 flex items-center justify-center",children:e.jsx(Ie,{size:36,strokeWidth:2.5})}),e.jsx("span",{className:"font-bold text-xl",children:"Check In"})]})]}),e.jsxs("button",{onClick:()=>A("out"),disabled:j||!P||!m.verified||!l.id||!h[l.id]||h[l.id]?.active===!1,className:"relative backdrop-blur-xl bg-gradient-to-br from-orange-400 to-red-500 border-2 border-white/40 rounded-3xl shadow-2xl overflow-hidden py-8 disabled:opacity-50 disabled:cursor-not-allowed active:scale-95 transition-all",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/20 to-transparent pointer-events-none"}),e.jsxs("div",{className:"relative flex flex-col items-center gap-3 text-white",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-white/20 flex items-center justify-center",children:e.jsx(Ce,{size:36,strokeWidth:2.5})}),e.jsx("span",{className:"font-bold text-xl",children:"Check Out"})]})]})]})]}),Y&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"relative backdrop-blur-2xl bg-white/95 border border-white/40 rounded-3xl max-w-md w-full overflow-hidden shadow-2xl",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-400/10 via-purple-400/10 to-pink-400/10 pointer-events-none"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex justify-between items-center p-5 border-b border-gray-200/50",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(G,{size:24,className:"text-blue-600"}),"Take Photo"]}),e.jsx("button",{onClick:ne,className:"p-2 rounded-full hover:bg-gray-200/50 transition",children:e.jsx(ye,{size:24})})]}),e.jsx("div",{className:"p-5",children:x?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative rounded-2xl overflow-hidden",children:e.jsx("img",{src:x,alt:"Captured",className:"w-full h-auto"})}),e.jsx("p",{className:"text-center text-green-600 text-sm font-medium",children:"âœ… Photo captured successfully"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("button",{onClick:ie,className:"relative backdrop-blur-xl bg-gray-400/80 border border-white/30 rounded-2xl shadow-lg p-3 text-white font-bold active:scale-95 transition-transform",children:"Retake"}),e.jsx("button",{onClick:le,disabled:j,className:"relative backdrop-blur-xl bg-gradient-to-br from-green-500 to-emerald-600 border border-white/30 rounded-2xl shadow-lg p-3 text-white font-bold disabled:opacity-50 active:scale-95 transition-transform",children:j?"Saving...":"Confirm"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative bg-gray-900 rounded-2xl overflow-hidden aspect-[3/4]",children:[e.jsx("video",{ref:f,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"w-48 h-64 border-4 border-white/50 rounded-full"})})]}),e.jsx("p",{className:"text-center text-gray-600 text-sm",children:"ðŸ“¸ Position your face in the circle"}),e.jsxs("button",{onClick:oe,className:"w-full relative backdrop-blur-xl bg-gradient-to-br from-blue-500 to-purple-600 border border-white/30 rounded-2xl shadow-xl p-4 text-white font-bold active:scale-95 transition-transform",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/20 to-transparent pointer-events-none rounded-2xl"}),e.jsxs("div",{className:"relative flex items-center justify-center gap-2",children:[e.jsx(G,{size:20}),e.jsx("span",{children:"Capture"})]})]})]})})]})]})}),e.jsx("canvas",{ref:D,style:{display:"none"}})]}),e.jsx(ge,{})]})}export{_e as default};
