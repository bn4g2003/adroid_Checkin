import{r as a,j as e}from"./index-CLFUPvU8.js";import{u as H}from"./useToast-Bj3fUG-2.js";import{g as y}from"./firebaseClient-DpnWcWEg.js";function $(){const{addToast:c}=H(),[x,E]=a.useState([]),[L,w]=a.useState(!0),[t,n]=a.useState({employeeId:"",fullName:"",department:"",team:"",position:"",branch:"",active:!0}),[u,p]=a.useState(!1),[g,K]=a.useState(""),[f,V]=a.useState(""),[A,C]=a.useState(!1),[r,j]=a.useState(null),[N,i]=a.useState(null);a.useEffect(()=>((async()=>{try{const{database:s,ref:l,onValue:d}=await y(),o=l(s,"employees");d(o,m=>{const v=m.val(),I=v?Object.keys(v).map(h=>({id:h,...v[h]})):[];I.sort((h,F)=>h.fullName.localeCompare(F.fullName)),E(I),w(!1)})}catch{i({type:"error",message:"Không thể tải dữ liệu nhân sự."}),c({type:"error",message:"Không thể tải dữ liệu nhân sự"}),w(!1)}})(),()=>{}),[c]),a.useEffect(()=>{const s=setTimeout(()=>V(g),300);return()=>clearTimeout(s)},[g]);const b=a.useMemo(()=>{if(!f)return x;const s=f.toLowerCase();return x.filter(l=>l.fullName?.toLowerCase().includes(s)||l.email?.toLowerCase().includes(s)||l.department?.toLowerCase().includes(s)||l.team?.toLowerCase().includes(s))},[f,x]),S=()=>{n({employeeId:"",fullName:"",department:"",team:"",position:"",branch:"",active:!0}),j(null),p(!1)},D=async s=>{if(s.preventDefault(),!t.employeeId||!t.fullName){i({type:"error",message:"Cần ít nhất Mã + Họ tên."});return}C(!0);try{const{database:l,ref:d,set:o}=await y(),m=d(l,`employees/${t.employeeId}`);await o(m,{fullName:t.fullName,department:t.department||null,team:t.team||null,position:t.position||null,branch:t.branch||null,active:t.active,createdAt:new Date().toISOString()}),i({type:"success",message:r?"Đã cập nhật nhân sự.":"Đã thêm nhân sự."}),c({type:"success",message:r?"Cập nhật nhân sự thành công":"Thêm nhân sự thành công"}),S()}catch{i({type:"error",message:"Lỗi lưu nhân sự."}),c({type:"error",message:"Lỗi lưu nhân sự"})}finally{C(!1),setTimeout(()=>i(null),2500)}},k=s=>{n({employeeId:s.id,fullName:s.fullName||"",department:s.department||"",team:s.team||"",position:s.position||"",branch:s.branch||"",active:s.active!==!1}),j(s.id),p(!0)},T=async s=>{try{const{database:l,ref:d,update:o}=await y(),m=d(l,`employees/${s.id}`);await o(m,{active:s.active===!1}),i({type:"success",message:s.active===!1?"Đã kích hoạt lại.":"Đã vô hiệu hoá."}),c({type:"success",message:s.active===!1?"Kích hoạt lại nhân sự":"Đã vô hiệu hoá nhân sự"}),setTimeout(()=>i(null),2e3)}catch{i({type:"error",message:"Không thể đổi trạng thái."}),c({type:"error",message:"Không thể đổi trạng thái"})}};return e.jsx("div",{className:"min-h-screen p-4 bg-gray-50",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs("header",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Quản lý Nhân sự"}),e.jsxs("div",{className:"flex items-center gap-2 w-full md:w-auto md:ml-auto",children:[e.jsx("input",{placeholder:"Tìm kiếm...",value:g,onChange:s=>K(s.target.value),className:"flex-1 px-3 py-2 rounded border focus:ring-2 focus:ring-indigo-500 text-sm md:w-60"}),e.jsx("button",{onClick:()=>{p(s=>!s),u||(j(null),n({employeeId:"",fullName:"",department:"",team:"",position:"",branch:"",active:!0}))},className:"px-4 py-2 rounded bg-indigo-600 text-white hover:bg-indigo-700 text-sm",children:u?"Đóng form":"Thêm nhân sự"})]})]}),N&&e.jsx("div",{className:`px-4 py-3 rounded text-sm font-medium ${N.type==="success"?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:N.message}),u&&e.jsxs("form",{onSubmit:D,className:"bg-white rounded-xl shadow p-4 grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Mã nhân viên *"}),e.jsx("input",{value:t.employeeId,onChange:s=>n({...t,employeeId:s.target.value.toUpperCase()}),disabled:r!==null,className:"w-full px-3 py-2 border rounded focus:ring-2 focus:ring-indigo-500",placeholder:"VD: NV001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Họ tên *"}),e.jsx("input",{value:t.fullName,onChange:s=>n({...t,fullName:s.target.value}),className:"w-full px-3 py-2 border rounded focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Phòng ban"}),e.jsx("input",{value:t.department,onChange:s=>n({...t,department:s.target.value}),className:"w-full px-3 py-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Team"}),e.jsx("input",{value:t.team,onChange:s=>n({...t,team:s.target.value}),className:"w-full px-3 py-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Vị trí"}),e.jsx("input",{value:t.position,onChange:s=>n({...t,position:s.target.value}),className:"w-full px-3 py-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Chi nhánh"}),e.jsx("input",{value:t.branch,onChange:s=>n({...t,branch:s.target.value}),className:"w-full px-3 py-2 border rounded"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-6",children:[e.jsx("input",{id:"active",type:"checkbox",checked:t.active,onChange:s=>n({...t,active:s.target.checked})}),e.jsx("label",{htmlFor:"active",className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"md:col-span-3 flex gap-2",children:[e.jsx("button",{type:"submit",disabled:A,className:"px-4 py-2 rounded bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-50",children:r?"Lưu thay đổi":"Thêm nhân sự"}),r&&e.jsx("button",{type:"button",onClick:S,className:"px-4 py-2 rounded bg-gray-100 hover:bg-gray-200",children:"Huỷ sửa"})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow p-4",children:L?e.jsx("div",{className:"text-sm text-gray-500",children:"Đang tải dữ liệu..."}):b.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"Không có nhân sự phù hợp."}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"overflow-x-auto hidden md:block",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 text-left",children:[e.jsx("th",{className:"p-2 font-medium",children:"Mã"}),e.jsx("th",{className:"p-2 font-medium",children:"Họ tên"}),e.jsx("th",{className:"p-2 font-medium",children:"Phòng ban"}),e.jsx("th",{className:"p-2 font-medium",children:"Team"}),e.jsx("th",{className:"p-2 font-medium",children:"Vị trí"}),e.jsx("th",{className:"p-2 font-medium",children:"Chi nhánh"}),e.jsx("th",{className:"p-2 font-medium",children:"Trạng thái"}),e.jsx("th",{className:"p-2 font-medium",children:"Hành động"})]})}),e.jsx("tbody",{children:b.map(s=>e.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[e.jsx("td",{className:"p-2 font-mono text-xs",children:s.id}),e.jsx("td",{className:"p-2",children:s.fullName}),e.jsx("td",{className:"p-2",children:s.department||e.jsx("span",{className:"text-gray-400",children:"—"})}),e.jsx("td",{className:"p-2",children:s.team||e.jsx("span",{className:"text-gray-400",children:"—"})}),e.jsx("td",{className:"p-2",children:s.position||e.jsx("span",{className:"text-gray-400",children:"—"})}),e.jsx("td",{className:"p-2",children:s.branch||e.jsx("span",{className:"text-gray-400",children:"—"})}),e.jsx("td",{className:"p-2",children:s.active===!1?e.jsx("span",{className:"px-2 py-1 rounded text-xs bg-red-100 text-red-700",children:"Inactive"}):e.jsx("span",{className:"px-2 py-1 rounded text-xs bg-green-100 text-green-700",children:"Active"})}),e.jsxs("td",{className:"p-2 space-x-1",children:[e.jsx("button",{onClick:()=>k(s),className:"text-indigo-600 hover:underline text-xs",children:"Sửa"}),e.jsx("button",{onClick:()=>T(s),className:"text-red-600 hover:underline text-xs",children:s.active===!1?"Kích hoạt":"Vô hiệu"})]})]},s.id))})]})}),e.jsx("div",{className:"md:hidden space-y-3",children:b.map(s=>e.jsxs("div",{className:"border rounded-lg p-3 bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:s.fullName}),e.jsx("div",{className:"text-xs text-gray-500 font-mono",children:s.id})]}),e.jsx("div",{children:s.active===!1?e.jsx("span",{className:"px-2 py-1 rounded text-[10px] bg-red-100 text-red-700",children:"Inactive"}):e.jsx("span",{className:"px-2 py-1 rounded text-[10px] bg-green-100 text-green-700",children:"Active"})})]}),e.jsxs("div",{className:"mt-2 text-xs space-y-1",children:[e.jsxs("div",{children:["Phòng ban: ",s.department||e.jsx("span",{className:"text-gray-400",children:"—"})]}),e.jsxs("div",{children:["Team: ",s.team||e.jsx("span",{className:"text-gray-400",children:"—"})]}),e.jsxs("div",{children:["Vị trí: ",s.position||e.jsx("span",{className:"text-gray-400",children:"—"})]})]}),e.jsxs("div",{className:"mt-2 flex gap-3 text-[11px] font-medium",children:[e.jsx("button",{onClick:()=>k(s),className:"text-indigo-600",children:"Sửa"}),e.jsx("button",{onClick:()=>T(s),className:"text-red-600",children:s.active===!1?"Kích hoạt":"Vô hiệu"})]})]},s.id))})]})})]})})}export{$ as default};
