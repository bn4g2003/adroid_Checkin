const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/exceljs.min-BdF6lXl0.js","assets/index-CLFUPvU8.js","assets/index-BUhAmb9H.css"])))=>i.map(i=>d[i]);
import{r as i,R as De,j as e,_ as xe}from"./index-CLFUPvU8.js";import{g as ee}from"./firebaseClient-DpnWcWEg.js";import{u as We}from"./useToast-Bj3fUG-2.js";import{c as Fe}from"./createLucideIcon-235Shsbz.js";import{W as Re}from"./wifi-COXQ1gS7.js";/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],_e=Fe("clock",He);function W(x){if(!x)return null;const[v,k]=x.split(":").map(Number);return v*60+k}function pe(x,v){const k={},C=W(v.standardCheckin),I=W(v.standardCheckout),o=W(v.lunchStart),p=W(v.lunchEnd);for(const c of x){const r=new Date(c.timestamp),S=r.getHours()*60+r.getMinutes();k[c.employeeId]||(k[c.employeeId]={employeeId:c.employeeId,employeeName:c.employeeName,ins:[],outs:[]}),c.type==="in"?k[c.employeeId].ins.push(S):c.type==="out"&&k[c.employeeId].outs.push(S)}const b={};for(const c of Object.keys(k)){const r=k[c];if(r.ins.length===0&&r.outs.length===0){b[c]={employeeId:c,employeeName:r.employeeName,status:"Vắng mặt",totalHours:0,late:!1,earlyDeparture:!1,firstIn:null,lastOut:null};continue}if(r.ins.length===0||r.outs.length===0){b[c]={employeeId:c,employeeName:r.employeeName,status:"Đang làm việc",totalHours:0,late:!1,earlyDeparture:!1,firstIn:r.ins.length>0?Math.min(...r.ins):null,lastOut:r.outs.length>0?Math.max(...r.outs):null};continue}const S=Math.min(...r.ins),m=Math.max(...r.outs);let P=Math.max(0,m-S);if(o!=null&&p!=null&&S<p&&m>o){const f=Math.max(S,o),A=Math.min(m,p),z=Math.max(0,A-f);P-=z}const U=+(P/60).toFixed(2),F=C!=null?S>C:!1,R=I!=null?m<I:!1;let y="Bình thường";F&&R?y="Trễ & Sớm":F?y="Trễ giờ":R&&(y="Về sớm"),b[c]={employeeId:c,employeeName:r.employeeName,status:y,totalHours:U,late:F,earlyDeparture:R,firstIn:S,lastOut:m}}return b}function Oe(x,v,k){const C=x.filter(p=>p.timestamp&&p.timestamp.startsWith(k)),I={};for(const p of C){const b=p.timestamp.slice(0,10);I[b]||(I[b]=[]),I[b].push(p)}const o={};for(const p of Object.keys(I)){const b=pe(I[p],v);for(const c of Object.keys(b)){const r=b[c];o[c]||(o[c]={employeeId:c,employeeName:r.employeeName,totalHours:0,days:0,lateCount:0,earlyDepartureCount:0}),o[c].totalHours+=r.totalHours,o[c].days+=1,r.late&&(o[c].lateCount+=1),r.earlyDeparture&&(o[c].earlyDepartureCount+=1)}}for(const p of Object.keys(o))o[p].totalHours=+o[p].totalHours.toFixed(2);return Object.values(o).sort((p,b)=>p.employeeName.localeCompare(b.employeeName))}function $e(){const{addToast:x}=We(),[v,k]=i.useState("wifi"),[C,I]=i.useState([]),[o,p]=i.useState([]),[b,c]=i.useState(!0),[r,S]=i.useState(!0),[m,P]=i.useState({name:"",publicIP:"",localIP:""}),[U,F]=i.useState(null),[R,y]=i.useState(null),[f,A]=i.useState({date:"",type:"",employee:""}),[z,ge]=i.useState(""),[T,H]=i.useState(1),[d,V]=i.useState({standardCheckin:"09:00",standardCheckout:"18:00",lunchStart:"12:00",lunchEnd:"13:00",standardHours:8}),ye=(t,s,a,l)=>{const n=W(t),h=W(s),u=W(a),w=W(l);if(!n||!h||!u||!w)return 8;const K=h-n,L=w-u;return+(Math.max(0,K-L)/60).toFixed(1)};De.useEffect(()=>{const t=ye(d.standardCheckin,d.standardCheckout,d.lunchStart,d.lunchEnd);t!==d.standardHours&&V(s=>({...s,standardHours:t}))},[d.standardCheckin,d.standardCheckout,d.lunchStart,d.lunchEnd,d.standardHours]);const[fe,de]=i.useState(!1),[G,me]=i.useState([]),[_,ae]=i.useState([]),[le,be]=i.useState({}),te=10,[Q,se]=i.useState(null),je=async()=>{try{const t=typeof E<"u"&&Array.isArray(E)&&E.length?E:o;if(!t.length){x({type:"error",message:"Không có dữ liệu để xuất"});return}const s=(await xe(async()=>{const{default:N}=await import("./exceljs.min-BdF6lXl0.js").then(g=>g.e);return{default:N}},__vite__mapDeps([0,1,2]))).default,a=new s.Workbook,l=a.addWorksheet("CheckinHistory"),n=["Thời gian","Mã NV","Họ tên","Type","WiFi","Public IP","Local IP","Ảnh hiện trường"];l.addRow(n);const h=l.getRow(1);h.font={bold:!0},h.alignment={vertical:"middle",horizontal:"center"},h.eachCell(N=>{N.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFEFF1F5"}}});for(let N=0;N<t.length;N++){const g=t[N],re=N+2;if(l.addRow([g.timestamp?new Date(g.timestamp).toLocaleString("vi-VN"):"",(g.employeeId||"").toUpperCase(),g.employeeName||"",g.type==="in"?"Check-in":g.type==="out"?"Check-out":g.type||"",g.wifi?.ssid||"",g.wifi?.publicIP||"",g.wifi?.localIP||"",g.photoBase64?"Có ảnh":"Không có"]),g.photoBase64)try{const Z=g.photoBase64.match(/^data:image\/(png|jpeg|jpg);base64,/i),Te=Z?Z[1].toLowerCase()==="jpg"?"jpeg":Z[1].toLowerCase():"jpeg",Ee=a.addImage({base64:g.photoBase64,extension:Te});l.addImage(Ee,{tl:{col:7,row:re-1},ext:{width:80,height:60}}),l.getRow(re).height=50}catch(Z){console.warn(`Error adding image for row ${re}:`,Z)}}[22,10,22,10,18,16,16,15].forEach((N,g)=>l.getColumn(g+1).width=N),l.views=[{state:"frozen",ySplit:1}];const w=await a.xlsx.writeBuffer(),K=new Blob([w],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),L=URL.createObjectURL(K),D=document.createElement("a");D.href=L;const j=new Date().toISOString().slice(0,10);D.download=`checkins_${j}.xlsx`,document.body.appendChild(D),D.click(),document.body.removeChild(D),URL.revokeObjectURL(L),x({type:"success",message:"Đã xuất Excel (XLSX) với ảnh"})}catch(t){console.error(t),x({type:"error",message:"Lỗi xuất XLSX"})}},Ne=async()=>{if(!_.length){x({type:"error",message:"Không có dữ liệu tháng để xuất"});return}try{const t=(await xe(async()=>{const{default:j}=await import("./exceljs.min-BdF6lXl0.js").then(N=>N.e);return{default:j}},__vite__mapDeps([0,1,2]))).default,s=new t.Workbook,a=s.addWorksheet("MonthlySummary"),l=["Mã NV","Họ tên","Số ngày","Tổng giờ","Số lần trễ","Số lần về sớm"];a.addRow(l);const n=a.getRow(1);n.font={bold:!0},n.alignment={vertical:"middle",horizontal:"center"},n.eachCell(j=>{j.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFEFF1F5"}}}),_.forEach(j=>{a.addRow([(j.employeeId||"").toUpperCase(),j.employeeName||"",j.days||0,j.totalHours||0,j.lateCount||0,j.earlyDepartureCount||0])}),[12,24,10,10,12,16].forEach((j,N)=>a.getColumn(N+1).width=j),a.views=[{state:"frozen",ySplit:1}];const u=await s.xlsx.writeBuffer(),w=new Blob([u],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),K=URL.createObjectURL(w),L=document.createElement("a");L.href=K;const D=new Date().toISOString().slice(0,7);L.download=`monthly_summary_${D}.xlsx`,document.body.appendChild(L),L.click(),document.body.removeChild(L),URL.revokeObjectURL(K),x({type:"success",message:"Đã xuất Excel (XLSX)"})}catch(t){console.error(t),x({type:"error",message:"Lỗi xuất XLSX"})}};i.useEffect(()=>{(async()=>{try{const{database:t,ref:s,onValue:a}=await ee();a(s(t,"companyWifis"),l=>{const n=l.val(),h=n?Object.keys(n).map(u=>({id:u,...n[u]})):[];h.sort((u,w)=>new Date(w.createdAt)-new Date(u.createdAt)),I(h),c(!1)}),a(s(t,"checkins"),l=>{const n=l.val(),h=n?Object.keys(n).map(u=>({id:u,...n[u]})):[];h.sort((u,w)=>new Date(w.timestamp)-new Date(u.timestamp)),p(h),S(!1)}),a(s(t,"workSettings/global"),l=>{const n=l.val();n&&V(h=>({...h,...n}))})}catch{y({type:"error",message:"Không thể tải dữ liệu."})}})()},[]);const he=new Date().toISOString().slice(0,10),ue=i.useMemo(()=>({todayCheckins:o.filter(t=>t.timestamp?.slice(0,10)===he).length,wifiCount:C.length}),[o,C,he]),ve=async()=>{try{const t=await fetch("https://api.ipify.org?format=json").then(a=>a.json()).then(a=>a.ip).catch(()=>"");let s="";try{s=await we()}catch{}P(a=>({...a,publicIP:t,localIP:s}))}catch{}},we=()=>new Promise((t,s)=>{const a=new RTCPeerConnection({iceServers:[]});a.createDataChannel(""),a.createOffer().then(l=>a.setLocalDescription(l)),a.onicecandidate=l=>{if(l&&l.candidate&&l.candidate.candidate){const n=/([0-9]{1,3}(\.[0-9]{1,3}){3})/.exec(l.candidate.candidate);n&&(t(n[1]),a.close())}},setTimeout(()=>{a.close(),s()},1500)}),ke=async t=>{if(t.preventDefault(),!m.name){y({type:"error",message:"Thiếu tên WiFi"});return}try{const{database:s,ref:a,push:l,update:n}=await ee();if(U)await n(a(s,`companyWifis/${U.id}`),{name:m.name,publicIP:m.publicIP||null,localIP:m.localIP||null}),y({type:"success",message:"Đã cập nhật WiFi"});else{const h=a(s,"companyWifis"),u={name:m.name,publicIP:m.publicIP||null,localIP:m.localIP||null,createdAt:new Date().toISOString()};await l(h,u),y({type:"success",message:"Đã thêm WiFi"})}P({name:"",publicIP:"",localIP:""}),F(null),setTimeout(()=>y(null),2e3)}catch{y({type:"error",message:"Lỗi lưu WiFi"}),x({type:"error",message:"Lỗi lưu WiFi"})}},Ce=t=>{F(t),P({name:t.name,publicIP:t.publicIP||"",localIP:t.localIP||""})},Ie=async t=>{if(confirm("Xoá WiFi này?"))try{const{database:s,ref:a,remove:l}=await ee();await l(a(s,`companyWifis/${t.id}`)),y({type:"success",message:"Đã xoá"}),x({type:"success",message:"Xoá WiFi thành công"}),setTimeout(()=>y(null),1500)}catch{y({type:"error",message:"Không thể xoá"}),x({type:"error",message:"Không thể xoá WiFi"})}},E=i.useMemo(()=>{let t=o;if(f.date){const s=new Date(`${f.date}T00:00:00`),a=new Date(`${f.date}T23:59:59.999`);t=t.filter(l=>{if(!l.timestamp)return!1;const n=new Date(l.timestamp);return n>=s&&n<=a})}if(f.type&&(t=t.filter(s=>s.type===f.type)),z){const s=z.toLowerCase();t=t.filter(a=>a.employeeId?.toLowerCase().includes(s)||a.employeeName?.toLowerCase().includes(s))}return t},[o,f.date,f.type,z]),$=Math.max(1,Math.ceil(E.length/te)),ne=E.slice((T-1)*te,T*te);console.log("DEBUG pagination:",{filteredHistoryLength:E.length,historyPageSize:te,page:T,totalPages:$,pageHistoryLength:ne.length}),i.useEffect(()=>{T>$&&H(1)},[$,T]);const M=10,[O,ie]=i.useState(1),J=Math.max(1,Math.ceil(C.length/M)),Se=C.slice((O-1)*M,O*M);i.useEffect(()=>{O>J&&ie(1)},[J,O]);const[X,ce]=i.useState(1),q=Math.max(1,Math.ceil(G.length/M)),Pe=G.slice((X-1)*M,X*M);i.useEffect(()=>{X>q&&ce(1)},[q,X]);const[B,oe]=i.useState(1),Y=Math.max(1,Math.ceil(_.length/M)),Le=_.slice((B-1)*M,B*M);i.useEffect(()=>{B>Y&&oe(1)},[Y,B]),i.useEffect(()=>{const t=setTimeout(()=>ge(f.employee),300);return()=>clearTimeout(t)},[f.employee]),i.useEffect(()=>{if(!o.length){me([]);return}const t=new Date().toISOString().slice(0,10),s=o.filter(n=>n.timestamp?.startsWith(t)),a=pe(s,d),l=Object.values(a);me(l),(async()=>{try{const{database:n,ref:h,set:u}=await ee();for(const w of l)await u(h(n,`workRecords/${t}/${w.employeeId}`),w)}catch{}})()},[o,d]),i.useEffect(()=>{if(!o.length){ae([]);return}const t=new Date().toISOString().slice(0,7);if(le[t]){ae(le[t]);return}const s=Oe(o,d,t);be(a=>({...a,[t]:s})),ae(s)},[o,d,le]);const Me=async t=>{t.preventDefault(),de(!0);try{const{database:s,ref:a,set:l}=await ee();await l(a(s,"workSettings/global"),d),y({type:"success",message:"Đã lưu cài đặt giờ làm việc"}),x({type:"success",message:"Lưu cài đặt giờ làm việc thành công"}),setTimeout(()=>y(null),2e3)}catch{y({type:"error",message:"Không thể lưu cài đặt giờ làm việc"}),x({type:"error",message:"Lỗi lưu cài đặt giờ làm việc"})}finally{de(!1)}};return e.jsx("div",{className:"min-h-screen p-4 bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white shadow rounded-xl p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(_e,{className:"text-indigo-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Check-ins hôm nay"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:ue.todayCheckins})]})]}),e.jsx("button",{className:"text-xs px-2 py-1 bg-indigo-50 text-indigo-600 rounded hover:bg-indigo-100",children:"Refresh"})]}),e.jsxs("div",{className:"bg-white shadow rounded-xl p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Re,{className:"text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"WiFi đã cấu hình"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:ue.wifiCount})]})]}),e.jsx("button",{className:"text-xs px-2 py-1 bg-green-50 text-green-600 rounded hover:bg-green-100",children:"Refresh"})]})]}),e.jsx("div",{className:"flex space-x-2",children:[{id:"wifi",label:"Quản lý WiFi"},{id:"history",label:"Lịch sử Check-in"},{id:"workhours",label:"Quản lý giờ làm việc"}].map(t=>e.jsx("button",{onClick:()=>k(t.id),className:`px-4 py-2 rounded-lg text-sm font-medium transition ${v===t.id?"bg-indigo-600 text-white":"bg-white shadow text-gray-700 hover:bg-gray-100"}`,children:t.label},t.id))}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-6 min-h-[300px]",children:[v==="wifi"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Quản lý WiFi"}),e.jsxs("form",{onSubmit:ke,className:"grid grid-cols-1 md:grid-cols-4 gap-4 text-sm bg-gray-50 p-4 rounded border",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Tên WiFi *"}),e.jsx("input",{value:m.name,onChange:t=>P({...m,name:t.target.value}),className:"w-full px-3 py-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Public IP"}),e.jsx("input",{value:m.publicIP,onChange:t=>P({...m,publicIP:t.target.value}),className:"w-full px-3 py-2 border rounded font-mono"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Local IP"}),e.jsx("input",{value:m.localIP,onChange:t=>P({...m,localIP:t.target.value}),className:"w-full px-3 py-2 border rounded font-mono"})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("button",{type:"button",onClick:ve,className:"px-3 py-2 bg-gray-100 rounded hover:bg-gray-200 text-xs",children:"Lấy IP hiện tại"}),e.jsx("button",{type:"submit",className:"px-3 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 text-xs",children:U?"Lưu":"Thêm"}),U&&e.jsx("button",{type:"button",onClick:()=>{F(null),P({name:"",publicIP:"",localIP:""})},className:"px-3 py-2 bg-gray-100 rounded text-xs",children:"Huỷ"})]})]}),R&&e.jsx("div",{className:`text-sm px-3 py-2 rounded ${R.type==="success"?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:R.message}),e.jsx("div",{className:"overflow-x-auto",children:b?e.jsx("div",{className:"text-sm text-gray-500",children:"Đang tải..."}):e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 text-left",children:[e.jsx("th",{className:"p-2 font-medium",children:"Tên"}),e.jsx("th",{className:"p-2 font-medium",children:"Public IP"}),e.jsx("th",{className:"p-2 font-medium",children:"Local IP"}),e.jsx("th",{className:"p-2 font-medium",children:"Tạo lúc"}),e.jsx("th",{className:"p-2 font-medium",children:"Hành động"})]})}),e.jsx("tbody",{children:Se.map(t=>e.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[e.jsx("td",{className:"p-2 font-medium",children:t.name}),e.jsx("td",{className:"p-2 font-mono text-xs",children:t.publicIP||e.jsx("span",{className:"text-gray-400",children:"—"})}),e.jsx("td",{className:"p-2 font-mono text-xs",children:t.localIP||e.jsx("span",{className:"text-gray-400",children:"—"})}),e.jsx("td",{className:"p-2 text-xs",children:t.createdAt?new Date(t.createdAt).toLocaleString("vi-VN"):"—"}),e.jsxs("td",{className:"p-2 space-x-1 text-xs",children:[e.jsx("button",{onClick:()=>Ce(t),className:"text-indigo-600 hover:underline",children:"Sửa"}),e.jsx("button",{onClick:()=>Ie(t),className:"text-red-600 hover:underline",children:"Xoá"})]})]},t.id))})]})}),!b&&e.jsxs("div",{className:"flex items-center justify-between mt-3 text-xs",children:[e.jsxs("span",{children:["Trang ",O," / ",J," (Tổng ",C.length,")"]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{disabled:O===1,onClick:()=>ie(t=>Math.max(1,t-1)),className:"px-2 py-1 border rounded disabled:opacity-40",children:"Prev"}),e.jsx("button",{disabled:O===J,onClick:()=>ie(t=>Math.min(J,t+1)),className:"px-2 py-1 border rounded disabled:opacity-40",children:"Next"})]})]})]}),v==="history"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Lịch sử Check-in"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-2 text-xs bg-gray-50 p-3 rounded border",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Ngày"}),e.jsx("input",{type:"date",value:f.date,onChange:t=>{A({...f,date:t.target.value}),H(1)},className:"w-full px-2 py-1 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Type"}),e.jsxs("select",{value:f.type,onChange:t=>{A({...f,type:t.target.value}),H(1)},className:"w-full px-2 py-1 border rounded",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"in",children:"Check-in"}),e.jsx("option",{value:"out",children:"Check-out"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block mb-1",children:"Nhân viên"}),e.jsx("input",{value:f.employee,onChange:t=>{A({...f,employee:t.target.value}),H(1)},className:"w-full px-2 py-1 border rounded",placeholder:"Tìm theo tên hoặc mã"})]}),e.jsxs("div",{className:"flex items-end",children:[e.jsx("button",{onClick:()=>{A({date:"",type:"",employee:""}),H(1)},className:"px-3 py-1 bg-gray-100 rounded text-xs hover:bg-gray-200",children:"Clear"}),e.jsx("button",{onClick:je,className:"ml-2 px-3 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700",children:"Export XLSX"})]})]}),r?e.jsx("div",{className:"space-y-2",children:Array.from({length:6}).map((t,s)=>e.jsx("div",{className:"h-8 bg-gray-100 animate-pulse rounded"},s))}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto hidden md:block",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 text-left",children:[e.jsx("th",{className:"p-2",children:"Thời gian"}),e.jsx("th",{className:"p-2",children:"Nhân viên"}),e.jsx("th",{className:"p-2",children:"Type"}),e.jsx("th",{className:"p-2",children:"WiFi"}),e.jsx("th",{className:"p-2",children:"Public IP"}),e.jsx("th",{className:"p-2",children:"Local IP"}),e.jsx("th",{className:"p-2",children:"Ảnh hiện trường"})]})}),e.jsx("tbody",{children:ne.map(t=>e.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[e.jsx("td",{className:"p-2 whitespace-nowrap",children:t.timestamp?new Date(t.timestamp).toLocaleString("vi-VN"):"—"}),e.jsxs("td",{className:"p-2",children:[t.employeeName," ",e.jsxs("span",{className:"text-gray-400",children:["(",t.employeeId,")"]})]}),e.jsx("td",{className:"p-2 font-medium",children:t.type==="in"?"IN":"OUT"}),e.jsx("td",{className:"p-2",children:t.wifi?.ssid}),e.jsx("td",{className:"p-2 font-mono",children:t.wifi?.publicIP||"—"}),e.jsx("td",{className:"p-2 font-mono",children:t.wifi?.localIP||"—"}),e.jsx("td",{className:"p-2",children:t.photoBase64?e.jsx("div",{className:"cursor-pointer",onClick:()=>se({src:t.photoBase64,employeeName:t.employeeName,timestamp:t.timestamp}),children:e.jsx("img",{src:t.photoBase64,alt:"Ảnh hiện trường",width:50,height:50})}):e.jsx("span",{className:"text-gray-400",children:"—"})})]},t.id))})]})}),e.jsx("div",{className:"md:hidden space-y-3",children:ne.map(t=>e.jsxs("div",{className:"border rounded-lg p-3 bg-gray-50",children:[e.jsx("div",{className:"text-xs text-gray-500",children:t.timestamp?new Date(t.timestamp).toLocaleString("vi-VN"):"—"}),e.jsxs("div",{className:"font-medium",children:[t.employeeName," ",e.jsxs("span",{className:"text-gray-400",children:["(",t.employeeId,")"]})]}),e.jsxs("div",{className:"text-xs",children:["Type: ",e.jsx("span",{className:"font-medium",children:t.type==="in"?"IN":"OUT"})]}),e.jsxs("div",{className:"text-xs",children:["WiFi: ",t.wifi?.ssid]}),e.jsxs("div",{className:"text-[11px] font-mono text-gray-600",children:["Public: ",t.wifi?.publicIP||"—"," | Local: ",t.wifi?.localIP||"—"]}),e.jsx("div",{className:"p-2",children:t.photoBase64?e.jsx("div",{className:"cursor-pointer",onClick:()=>se({src:t.photoBase64,employeeName:t.employeeName,timestamp:t.timestamp}),children:e.jsx("img",{src:t.photoBase64,alt:"Ảnh hiện trường",width:50,height:50})}):e.jsx("span",{className:"text-gray-400",children:"—"})})]},t.id))}),e.jsxs("div",{className:"flex items-center justify-between mt-3 text-xs",children:[e.jsxs("span",{children:["Trang ",T," / ",$," (Tổng ",E.length,")"]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{disabled:T===1,onClick:()=>H(t=>Math.max(1,t-1)),className:"px-2 py-1 border rounded disabled:opacity-40",children:"Prev"}),e.jsx("button",{disabled:T===$,onClick:()=>H(t=>Math.min($,t+1)),className:"px-2 py-1 border rounded disabled:opacity-40",children:"Next"})]})]})]})]}),v==="workhours"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Quản lý giờ làm việc"}),e.jsxs("form",{onSubmit:Me,className:"grid grid-cols-2 md:grid-cols-6 gap-4 bg-gray-50 p-4 rounded border text-xs",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Giờ vào"}),e.jsx("input",{value:d.standardCheckin,onChange:t=>V(s=>({...s,standardCheckin:t.target.value})),type:"time",className:"w-full px-2 py-1 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Giờ ra"}),e.jsx("input",{value:d.standardCheckout,onChange:t=>V(s=>({...s,standardCheckout:t.target.value})),type:"time",className:"w-full px-2 py-1 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Giờ nghỉ trưa"}),e.jsx("input",{value:d.lunchStart,onChange:t=>V(s=>({...s,lunchStart:t.target.value})),type:"time",className:"w-full px-2 py-1 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Giờ kết thúc nghỉ trưa"}),e.jsx("input",{value:d.lunchEnd,onChange:t=>V(s=>({...s,lunchEnd:t.target.value})),type:"time",className:"w-full px-2 py-1 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Số giờ làm (tự động)"}),e.jsx("input",{value:d.standardHours,readOnly:!0,disabled:!0,className:"w-full px-2 py-1 border rounded bg-gray-100 text-gray-600 cursor-not-allowed"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{disabled:fe,type:"submit",className:"px-3 py-2 bg-indigo-600 text-white rounded text-xs disabled:opacity-50",children:"Lưu"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2 text-sm",children:"Daily Records (Hôm nay)"}),G.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Chưa đủ dữ liệu."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"p-2 text-left",children:"Nhân viên"}),e.jsx("th",{className:"p-2 text-left",children:"Status"}),e.jsx("th",{className:"p-2 text-left",children:"Giờ làm"}),e.jsx("th",{className:"p-2 text-left",children:"Late"}),e.jsx("th",{className:"p-2 text-left",children:"Early"})]})}),e.jsx("tbody",{children:Pe.map(t=>e.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[e.jsxs("td",{className:"p-2",children:[t.employeeName," ",e.jsxs("span",{className:"text-gray-400",children:["(",t.employeeId,")"]})]}),e.jsx("td",{className:"p-2",children:t.status}),e.jsx("td",{className:"p-2",children:t.totalHours}),e.jsx("td",{className:"p-2",children:t.late?"✔️":"—"}),e.jsx("td",{className:"p-2",children:t.earlyDeparture?"✔️":"—"})]},t.employeeId))})]})}),G.length>0&&e.jsxs("div",{className:"flex items-center justify-between mt-3 text-xs",children:[e.jsxs("span",{children:["Trang ",X," / ",q," (Tổng ",G.length,")"]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{disabled:X===1,onClick:()=>ce(t=>Math.max(1,t-1)),className:"px-2 py-1 border rounded disabled:opacity-40",children:"Prev"}),e.jsx("button",{disabled:X===q,onClick:()=>ce(t=>Math.min(q,t+1)),className:"px-2 py-1 border rounded disabled:opacity-40",children:"Next"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-sm",children:"Monthly Summary (Tháng hiện tại)"}),e.jsx("button",{onClick:Ne,className:"px-3 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700",children:"Export XLSX"})]}),_.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Chưa có dữ liệu tháng."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"p-2 text-left",children:"Nhân viên"}),e.jsx("th",{className:"p-2 text-left",children:"Ngày làm"}),e.jsx("th",{className:"p-2 text-left",children:"Tổng giờ"}),e.jsx("th",{className:"p-2 text-left",children:"Late"}),e.jsx("th",{className:"p-2 text-left",children:"Early"})]})}),e.jsx("tbody",{children:Le.map(t=>e.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[e.jsxs("td",{className:"p-2",children:[t.employeeName," ",e.jsxs("span",{className:"text-gray-400",children:["(",t.employeeId,")"]})]}),e.jsx("td",{className:"p-2",children:t.days}),e.jsx("td",{className:"p-2",children:t.totalHours}),e.jsx("td",{className:"p-2",children:t.lateCount}),e.jsx("td",{className:"p-2",children:t.earlyDepartureCount})]},t.employeeId))})]})}),_.length>0&&e.jsxs("div",{className:"flex items-center justify-between mt-3 text-xs",children:[e.jsxs("span",{children:["Trang ",B," / ",Y," (Tổng ",_.length,")"]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{disabled:B===1,onClick:()=>oe(t=>Math.max(1,t-1)),className:"px-2 py-1 border rounded disabled:opacity-40",children:"Prev"}),e.jsx("button",{disabled:B===Y,onClick:()=>oe(t=>Math.min(Y,t+1)),className:"px-2 py-1 border rounded disabled:opacity-40",children:"Next"})]})]})]})]})]})]}),Q&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>se(null),children:e.jsxs("div",{className:"bg-white p-4 rounded shadow-lg max-w-[90%] max-h-[90%] overflow-auto",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"font-semibold",children:Q.employeeName}),e.jsx("button",{onClick:()=>se(null),className:"text-gray-500 hover:text-gray-900",children:"✕"})]}),e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:Q.timestamp?new Date(Q.timestamp).toLocaleString("vi-VN"):""}),e.jsx("img",{src:Q.src,alt:"Ảnh checkin",className:"max-w-full max-h-[70vh] object-contain rounded"})]})})]})})}export{$e as default};
