import{u as A,r as o,j as e}from"./index-V-x1CcZ_.js";import{c as O,u as H,g as w}from"./useToast-C0bm4l8s.js";import{C as g,B}from"./BottomNav-BtuPnx2H.js";import{C as L}from"./calendar-BoSvrQ7h.js";import{a as k,C as V,b as F}from"./circle-x-W5mkuklc.js";/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],u=O("file-text",P);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],S=O("send",_);function G(){const h=A(),{addToast:i}=H(),[b,R]=o.useState(""),[j,z]=o.useState(""),[f,y]=o.useState([]),[N,v]=o.useState(!1),[s,n]=o.useState({date:"",startTime:"",endTime:"",reason:"",description:""});o.useEffect(()=>{const t=localStorage.getItem("employeeSessionId"),a=localStorage.getItem("employeeSessionName");if(!t){i({type:"error",message:"Vui lòng đăng nhập"}),h("/employee-login");return}R(t),z(a||""),D(t)},[h,i]);const D=async t=>{try{const{database:a,ref:r,onValue:l}=await w(),d=r(a,"otRequests");l(d,x=>{const c=x.val();if(c){const E=Object.entries(c).map(([m,p])=>({id:m,...p})).filter(m=>m.employeeId===t).sort((m,p)=>new Date(p.createdAt)-new Date(m.createdAt));y(E)}else y([])})}catch(a){console.error("Error loading OT requests:",a),i({type:"error",message:"Lỗi khi tải danh sách OT"})}},T=()=>{if(!s.startTime||!s.endTime)return 0;const[t,a]=s.startTime.split(":").map(Number),[r,l]=s.endTime.split(":").map(Number),d=t*60+a;return((r*60+l-d)/60).toFixed(1)},C=async t=>{if(t.preventDefault(),!s.date||!s.startTime||!s.endTime||!s.reason){i({type:"error",message:"Vui lòng điền đầy đủ thông tin"});return}const a=parseFloat(T());if(a<=0){i({type:"error",message:"Thời gian kết thúc phải sau thời gian bắt đầu"});return}v(!0);try{const{database:r,ref:l,push:d}=await w(),x=l(r,"otRequests"),c={employeeId:b,employeeName:j,date:s.date,startTime:s.startTime,endTime:s.endTime,hours:a,reason:s.reason,description:s.description||"",status:"pending",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};await d(x,c),i({type:"success",message:"Đăng ký OT thành công!"}),n({date:"",startTime:"",endTime:"",reason:"",description:""})}catch(r){console.error("Error submitting OT:",r),i({type:"error",message:"Lỗi khi đăng ký OT"})}finally{v(!1)}},M=t=>{const a={pending:{bg:"bg-yellow-100",text:"text-yellow-700",label:"Pending"},approved:{bg:"bg-green-100",text:"text-green-700",label:"Approved"},rejected:{bg:"bg-red-100",text:"text-red-700",label:"Rejected"}},r=a[t]||a.pending;return e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${r.bg} ${r.text}`,children:r.label})},I=t=>t==="approved"?e.jsx(V,{size:20,className:"text-green-500"}):t==="rejected"?e.jsx(F,{size:20,className:"text-red-500"}):e.jsx(k,{size:20,className:"text-yellow-500"});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 pb-24 p-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs("div",{className:"relative backdrop-blur-xl bg-white/90 border border-white/40 rounded-3xl shadow-2xl overflow-hidden p-6",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-50/50 to-purple-50/50 pointer-events-none"}),e.jsxs("h1",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(g,{className:"text-indigo-600"}),"Overtime (OT) Registration"]}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["Employee: ",j," (",b,")"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"relative backdrop-blur-xl bg-white/90 border border-white/40 rounded-3xl shadow-xl overflow-hidden p-6",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-green-50/30 to-transparent pointer-events-none"}),e.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(S,{className:"text-indigo-600"}),"New OT Registration"]}),e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(L,{size:16,className:"inline mr-1"}),"OT Date *"]}),e.jsx("input",{type:"date",value:s.date,onChange:t=>n({...s,date:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(g,{size:16,className:"inline mr-1"}),"Start Time *"]}),e.jsx("input",{type:"time",value:s.startTime,onChange:t=>n({...s,startTime:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(g,{size:16,className:"inline mr-1"}),"End Time *"]}),e.jsx("input",{type:"time",value:s.endTime,onChange:t=>n({...s,endTime:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",required:!0})]})]}),s.startTime&&s.endTime&&e.jsx("div",{className:"bg-indigo-50 p-3 rounded-lg",children:e.jsxs("p",{className:"text-sm text-indigo-700",children:["Total OT Hours: ",e.jsxs("span",{className:"font-bold text-lg",children:[T(),"h"]})]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(u,{size:16,className:"inline mr-1"}),"Reason *"]}),e.jsxs("select",{value:s.reason,onChange:t=>n({...s,reason:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",required:!0,children:[e.jsx("option",{value:"",children:"-- Select Reason --"}),e.jsx("option",{value:"Urgent Project",children:"Urgent Project"}),e.jsx("option",{value:"Tight Deadline",children:"Tight Deadline"}),e.jsx("option",{value:"Team Support",children:"Team Support"}),e.jsx("option",{value:"Backlog Work",children:"Backlog Work"}),e.jsx("option",{value:"Other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Detailed Description"}),e.jsx("textarea",{value:s.description,onChange:t=>n({...s,description:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",rows:"3",placeholder:"Describe the work that requires OT..."})]}),e.jsxs("button",{type:"submit",disabled:N,className:"w-full relative backdrop-blur-xl bg-gradient-to-br from-blue-500 to-purple-600 border border-white/30 rounded-2xl shadow-xl p-4 text-white font-bold disabled:opacity-50 active:scale-95 transition-transform",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/20 to-transparent pointer-events-none rounded-2xl"}),e.jsxs("div",{className:"relative flex items-center justify-center gap-2",children:[e.jsx(S,{size:18}),e.jsx("span",{children:N?"Submitting...":"Submit Registration"})]})]})]})]}),e.jsxs("div",{className:"relative backdrop-blur-xl bg-white/90 border border-white/40 rounded-3xl shadow-xl overflow-hidden p-6",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-50/30 to-transparent pointer-events-none"}),e.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(u,{className:"text-indigo-600"}),"OT Registration History"]}),e.jsx("div",{className:"space-y-3 max-h-[600px] overflow-y-auto",children:f.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(k,{size:48,className:"mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No OT registrations yet"})]}):f.map(t=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[I(t.status),e.jsx("span",{className:"font-semibold text-gray-800",children:new Date(t.date).toLocaleDateString("vi-VN")})]}),M(t.status)]}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("p",{children:[e.jsx(g,{size:14,className:"inline mr-1"}),"Time: ",t.startTime," - ",t.endTime," (",t.hours,"h)"]}),e.jsxs("p",{children:[e.jsx(u,{size:14,className:"inline mr-1"}),"Reason: ",t.reason]}),t.description&&e.jsxs("p",{className:"text-gray-500 italic",children:['"',t.description,'"']}),t.approverNote&&e.jsxs("div",{className:"mt-2 p-2 bg-gray-50 rounded",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Manager's Note:"}),e.jsx("p",{className:"text-sm",children:t.approverNote})]}),e.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:["Registered at: ",new Date(t.createdAt).toLocaleString("vi-VN")]})]})]},t.id))})]})]})]})}),e.jsx(B,{})]})}export{G as default};
